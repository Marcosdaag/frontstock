<style>
    /* PersonalizaciÃ³n del Scrollbar */
    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(17, 24, 39, 0.5);
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.6);
    }
</style>

<div class="flex flex-col h-[calc(100vh-140px)] text-gray-100 animate-enter font-sans">

    <header
        class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6 shrink-0 border-b border-white/10 pb-4">
        <h1
            class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-indigo-200 to-blue-200 drop-shadow-sm flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                class="w-8 h-8 text-indigo-400">
                <path
                    d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" />
            </svg>
            GestiÃ³n de Ã“rdenes
        </h1>

        <div class="flex bg-gray-900/60 p-1.5 rounded-xl border border-white/10 backdrop-blur-md">
            <button (click)="vistaActual = 'NUEVA'"
                class="px-6 py-2 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2"
                [ngClass]="vistaActual === 'NUEVA' 
                    ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30' 
                    : 'text-gray-400 hover:text-white hover:bg-white/5'">
                <span>âœ¨</span> Nueva Venta
            </button>
            <button (click)="vistaActual = 'HISTORIAL'"
                class="px-6 py-2 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2"
                [ngClass]="vistaActual === 'HISTORIAL' 
                    ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30' 
                    : 'text-gray-400 hover:text-white hover:bg-white/5'">
                <span>ðŸ“œ</span> Historial
            </button>
        </div>
    </header>

    <div *ngIf="vistaActual === 'NUEVA'"
        class="flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-12 gap-6 animate-enter">

        <div class="lg:col-span-8 xl:col-span-9 flex flex-col h-full overflow-hidden">

            <div class="relative mb-6 shrink-0 group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-5 h-5 text-indigo-400 group-focus-within:text-indigo-300 transition-colors">
                        <path fill-rule="evenodd"
                            d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
                <input type="text" placeholder="Buscar producto..." [(ngModel)]="terminoBusqueda"
                    (input)="filtrarProductos()"
                    class="w-full p-4 pl-12 bg-gray-800/50 backdrop-blur-md text-white border border-white/10 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 shadow-lg text-lg font-medium placeholder-gray-500 transition-all hover:bg-gray-800/70">
            </div>

            <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar pb-4">
                <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">

                    <div
                        class="bg-indigo-900/10 border border-indigo-500/30 p-4 rounded-2xl shadow-lg flex flex-col justify-between h-full min-h-[160px] relative group hover:bg-indigo-900/20 hover:border-indigo-500/50 transition-all duration-300">
                        <div class="mb-2">
                            <p
                                class="text-[10px] font-bold text-indigo-400 uppercase tracking-wider mb-1 flex items-center gap-1">
                                Manual
                            </p>
                            <h3 class="font-bold text-white text-lg leading-tight">Personalizado</h3>
                        </div>
                        <div class="flex flex-col gap-2 mt-auto">
                            <input type="text" [(ngModel)]="descripcionManual" placeholder="Ej: Pan"
                                class="w-full bg-gray-900/60 border border-indigo-500/20 rounded-lg px-2 py-2 text-white text-xs font-bold focus:outline-none focus:border-indigo-400 focus:bg-gray-900 placeholder-gray-600 transition-colors">
                            <div class="flex gap-2">
                                <input type="number" [(ngModel)]="montoManual" (keyup.enter)="agregarItemManual()"
                                    placeholder="$0"
                                    class="w-full bg-gray-900/60 border border-indigo-500/20 rounded-lg px-2 py-2 text-white text-sm font-bold focus:outline-none focus:border-indigo-400 focus:bg-gray-900 text-center placeholder-gray-600 transition-colors">
                                <button (click)="agregarItemManual()"
                                    class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 rounded-lg transition-all shadow-lg shadow-indigo-500/20 hover:scale-105 active:scale-95 flex items-center justify-center">
                                    +
                                </button>
                            </div>
                        </div>
                    </div>

                    <ng-container *ngIf="productos.length > 0">
                        <ng-container *ngFor="let prod of productos">
                            <div *ngIf="!prod.name.toLowerCase().includes('varios')" (click)="agregarAlCarrito(prod)"
                                class="bg-gray-800/40 backdrop-blur-sm p-4 rounded-2xl shadow-lg hover:shadow-indigo-500/20 hover:-translate-y-1 cursor-pointer transition-all duration-300 border border-white/5 hover:border-indigo-500/30 group relative flex flex-col justify-between h-full min-h-[160px] overflow-hidden">

                                <div
                                    class="absolute inset-0 bg-gradient-to-br from-indigo-500/0 to-indigo-500/0 group-hover:from-indigo-500/5 group-hover:to-purple-500/10 transition-all duration-500">
                                </div>

                                <div class="absolute top-2 right-2 text-xs font-black px-3 py-1 rounded-lg border shadow-md z-10 tracking-wide"
                                    [ngClass]="prod.stock > 0 
                                    ? 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30' 
                                    : 'bg-rose-500/20 text-rose-300 border-rose-500/30'">
                                    {{ prod.stock }}
                                </div>

                                <div class="mt-2 relative z-10">
                                    <p
                                        class="text-[10px] font-bold text-indigo-300 uppercase tracking-wider mb-1 opacity-70 group-hover:opacity-100 transition-opacity">
                                        {{ prod.brand }}
                                    </p>
                                    <h3
                                        class="font-bold text-gray-100 text-lg leading-tight group-hover:text-white line-clamp-2 transition-colors">
                                        {{ prod.name }}
                                    </h3>
                                </div>

                                <div
                                    class="flex justify-between items-end mt-4 pt-3 border-t border-white/5 relative z-10">
                                    <span
                                        class="text-2xl font-black text-gray-100 tracking-tight group-hover:text-indigo-200 transition-colors">${{
                                        prod.price }}</span>

                                    <div
                                        class="bg-indigo-500/10 text-indigo-400 p-2 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-indigo-500/40">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                            class="w-5 h-5">
                                            <path fill-rule="evenodd"
                                                d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>

                </div>
            </div>
        </div>

        <div class="lg:col-span-4 xl:col-span-3 flex flex-col h-full min-h-0">

            <div
                class="bg-gray-800/60 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/10 flex flex-col h-full overflow-hidden relative">

                <div
                    class="p-5 border-b border-white/10 bg-gray-900/30 shrink-0 flex justify-between items-center z-20">
                    <h2 class="font-extrabold text-white text-xl flex items-center gap-2 tracking-tight">
                        <span>ðŸ›’ Ticket</span>
                    </h2>
                    <span
                        class="text-xs bg-indigo-600 text-white px-2.5 py-1 rounded-full font-bold shadow-lg shadow-indigo-500/20">
                        {{ carrito.length }} items
                    </span>
                </div>

                <div class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar min-h-0">

                    <div *ngFor="let item of carrito; let i = index"
                        class="flex justify-between items-center bg-gray-900/40 hover:bg-gray-900/60 p-3 rounded-xl border border-white/5 hover:border-indigo-500/30 transition-all duration-200 group shrink-0">

                        <div class="flex-1 min-w-0 pr-3">
                            <p
                                class="text-sm font-bold text-gray-200 truncate group-hover:text-white transition-colors">
                                {{ item.customName || item.producto.name }}
                            </p>
                            <p class="text-xs text-indigo-300 font-semibold mt-0.5">
                                {{ item.cantidad }} x ${{ item.producto.price }}
                            </p>
                        </div>

                        <div class="flex items-center gap-3 shrink-0">
                            <span class="font-bold text-white text-base">${{ item.subtotal }}</span>
                            <button (click)="eliminarDelCarrito(i)"
                                class="text-gray-500 hover:text-rose-400 hover:bg-rose-500/10 p-1.5 rounded-lg transition-all transform hover:scale-110">
                                âœ–
                            </button>
                        </div>
                    </div>

                    <div *ngIf="carrito.length === 0"
                        class="flex flex-col items-center justify-center h-full opacity-40 min-h-[200px]">
                        <p class="text-sm font-medium text-gray-400">Carrito vacÃ­o</p>
                    </div>
                </div>

                <div class="p-5 bg-gray-900/50 border-t border-white/10 shrink-0 backdrop-blur-sm z-20 relative">
                    <div class="flex justify-between items-end mb-4">
                        <span class="text-gray-400 font-bold text-sm uppercase tracking-wider">Total</span>
                        <span class="text-4xl font-black text-emerald-400 tracking-tight">${{ total }}</span>
                    </div>
                    <button (click)="confirmarVenta()" [disabled]="carrito.length === 0"
                        class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white font-extrabold text-lg py-4 rounded-xl shadow-lg shadow-emerald-500/20 transition-all transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed">
                        PAGAR
                    </button>
                </div>

            </div>
        </div>
    </div>

    <div *ngIf="vistaActual === 'HISTORIAL'" class="flex-1 overflow-hidden bg-transparent animate-enter flex flex-col">
        <div class="flex-1 overflow-y-auto custom-scrollbar px-1">

            <table class="min-w-full border-separate border-spacing-y-4 text-left">

                <thead class="sticky top-0 z-10">
                    <tr>
                        <th
                            class="px-6 py-3 text-xs font-bold text-gray-400 uppercase tracking-wider w-32 bg-gray-900/80 backdrop-blur-md rounded-l-xl">
                            Fecha</th>
                        <th
                            class="px-6 py-3 text-xs font-bold text-gray-400 uppercase tracking-wider bg-gray-900/80 backdrop-blur-md">
                            Productos</th>
                        <th
                            class="px-6 py-3 text-xs font-bold text-gray-400 uppercase tracking-wider w-36 bg-gray-900/80 backdrop-blur-md">
                            Total</th>
                        <th
                            class="px-6 py-3 text-right text-xs font-bold text-gray-400 uppercase tracking-wider w-24 bg-gray-900/80 backdrop-blur-md rounded-r-xl">
                            Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let orden of historial"
                        class="group bg-gray-800/60 hover:bg-gray-800/90 shadow-md hover:shadow-xl hover:shadow-indigo-500/10 transition-all duration-300 hover:scale-[1.005]">

                        <td
                            class="px-6 py-6 text-sm font-bold text-gray-100 align-top rounded-l-2xl border-y border-l border-white/5 group-hover:border-indigo-500/30">
                            <div class="flex flex-col">
                                <span class="text-lg text-white font-black">{{ orden.createdAt | date:'dd MMM' }}</span>
                                <span class="text-xs text-indigo-300 font-mono mt-1 font-bold opacity-80">{{
                                    orden.createdAt | date:'HH:mm' }} hs</span>
                            </div>
                        </td>

                        <td class="px-6 py-6 align-top border-y border-white/5 group-hover:border-indigo-500/30">
                            <div class="flex flex-col gap-3">
                                <div *ngFor="let item of orden.products"
                                    class="flex items-center gap-4 bg-gray-900/50 border border-black/20 px-4 py-2.5 rounded-xl hover:bg-gray-900/80 transition-colors">

                                    <span class="text-lg font-black text-indigo-400 min-w-[30px]">{{ item.quantity
                                        }}x</span>

                                    <div class="flex flex-col leading-tight">
                                        <span *ngIf="!item.customName"
                                            class="text-[10px] font-bold text-gray-500 uppercase tracking-wider mb-0.5">
                                            {{ item.product?.brand }}
                                        </span>
                                        <span class="text-base font-bold text-gray-200"
                                            title="{{ item.customName || item.product?.name }}">
                                            {{ item.customName || item.product?.name || 'Producto eliminado' }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </td>

                        <td
                            class="px-6 py-6 text-2xl font-black text-emerald-400 align-top drop-shadow-sm border-y border-white/5 group-hover:border-indigo-500/30">
                            ${{ orden.total }}
                        </td>

                        <td
                            class="px-6 py-6 text-right align-top rounded-r-2xl border-y border-r border-white/5 group-hover:border-indigo-500/30">
                            <button (click)="borrarOrden(orden._id)"
                                class="text-gray-500 hover:text-rose-400 hover:bg-rose-500/10 p-3 rounded-xl transition-all hover:scale-110 shadow-sm border border-transparent hover:border-rose-500/20"
                                title="Eliminar registro">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                    class="w-6 h-6">
                                    <path fill-rule="evenodd"
                                        d="M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.49 1.478l-.56.075-.992 12.413a3 3 0 01-2.991 2.766H8.784a3 3 0 01-2.991-2.766L4.803 6.694l-.56-.075a.75.75 0 01-.49-1.478A48.567 48.567 0 017.5 4.478a3.033 3.033 0 015.002 0zm-1.375 2.977a.75.75 0 00-1.5 0v6.75a.75.75 0 001.5 0v-6.75zm-4.5 0a.75.75 0 00-1.5 0v6.75a.75.75 0 001.5 0v-6.75z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>